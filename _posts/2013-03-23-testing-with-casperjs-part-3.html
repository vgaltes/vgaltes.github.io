---
layout: post
status: publish
published: true
title: Testing with CasperJS - Part 3
author:
  display_name: vgaltesc
  login: vgaltesc
  email: vincentredrum@gmail.com
  url: ''
author_login: vgaltesc
author_email: vincentredrum@gmail.com
wordpress_id: 72
wordpress_url: http://vgaltes.com/?p=72
date: '2013-03-23 09:50:11 +0000'
date_gmt: '2013-03-23 09:50:11 +0000'
categories:
- Code
tags:
- javascript
- casperjs
- web
- testing
comments:
- id: 6
  author: David Frahm
  author_email: david@midmoapps.com
  author_url: http://www.midmoapps.com
  date: '2013-03-23 17:23:42 +0000'
  date_gmt: '2013-03-23 17:23:42 +0000'
  content: "Can't thank you enough for these CasperJS tutorials.  Very informative
    and easy to follow.\r\n\r\nI am working on tests for my first AngularJS application
    and you've saved me a bunch of time as well as increased the quality of my tests."
- id: 7
  author: vgaltesc
  author_email: vincentredrum@gmail.com
  author_url: ''
  date: '2013-03-24 09:59:40 +0000'
  date_gmt: '2013-03-24 09:59:40 +0000'
  content: Thank you very much David!
- id: 23664
  author: Mark Jones
  author_email: mark@radicalgeek.co.uk
  author_url: http://www.radicalgeek.co.uk
  date: '2014-06-05 09:01:23 +0100'
  date_gmt: '2014-06-05 09:01:23 +0100'
  content: Did you ever get this integrated into your TFS build?
- id: 23686
  author: vgaltesc
  author_email: vincentredrum@gmail.com
  author_url: ''
  date: '2014-07-11 19:25:16 +0100'
  date_gmt: '2014-07-11 19:25:16 +0100'
  content: No, but it doesn't have to be difficult. Now you can execute scripts as
    part of your build. Or you can launch a console application and parse the results.
    But yes, it's a little bit of work.
---
<p>In the previous tutorials ( <a title="Testing with CasperJS – Part 1" href="http://vgaltes.com/index.php/2013/03/14/testing-with-casperjs-part-1/" target="_blank">1</a> and <a title="Testing with CasperJS – Part 2" href="http://vgaltes.com/index.php/2013/03/16/testing-with-casperjs-part-2/" target="_blank">2</a> ) we have seen how to install <a title="CasperJS" href="http://casperjs.org/" target="_blank">CasperJS </a>and make our first script. Today we are going to start writing tests with the API that <a title="CasperJS" href="http://casperjs.org/" target="_blank">CasperJS</a> provide and doing some navigation between pages. To do that we will add a new model in our website:</p>
<pre class="brush:csharp">public class InformationRequest
{
    public int InformationRequestId { get; set; }
    public string Name { get; set; }
    public string Surname { get; set; }
    public string Email { get; set; }
    public string Request { get; set; }
}</pre>
<p>Now, using the capabilities of <a title="Visual Studio 2012" href="http://www.microsoft.com/visualstudio/eng" target="_blank">Visual Studio 2012</a> and <a title="ASP.NET" href="http://www.asp.net/" target="_blank">ASP.NET MVC</a>, we could make a new controller and views easily to create a form to request information. Add a new controller using the template which uses <a title="Entity framework" href="http://msdn.microsoft.com/en-us/data/ef.aspx" target="_blank">Entity Framework</a>.</p>
<p>[caption id="attachment_73" align="alignnone" width="604"]<a href="http://vgaltes.com/wp-content/uploads/2013/03/AddController.png"><img class="size-full wp-image-73" alt="add new controller" src="http://vgaltes.com/wp-content/uploads/2013/03/AddController.png" width="604" height="393" /></a> add new controller[/caption]</p>
<p>Don't worry about the Data Context, we will not use it. Now we have a skeleton of controller methods and views to submit the form. Remove any reference to Entity Framework and the edit, delete, and list methods and views. Your project must look like the one in this screenshot</p>
<p>[caption id="attachment_75" align="alignnone" width="566"]<a href="http://vgaltes.com/wp-content/uploads/2013/03/Project.png"><img class="size-full wp-image-75" alt="solution explorer" src="http://vgaltes.com/wp-content/uploads/2013/03/Project.png" width="566" height="407" /></a> solution explorer[/caption]</p>
<p>The controller must have this code</p>
<pre class="brush:csharp">public class InformationRequestController : Controller
{
    public ActionResult Index()
    {
        return RedirectToAction("Create");
    }

    public ActionResult Create()
    {
        return View();
    }

    [HttpPost]
    [ValidateAntiForgeryToken]
    public ActionResult Create(InformationRequest informationrequest)
    {
        return View("Thanks", informationrequest);
    }
}</pre>
<p>And the Thanks.cshtml view is a very simple view with this markup</p>
<pre class="brush:php">@model TestCasperJS.Models.InformationRequest

@{
    ViewBag.Title = "Thanks";
}

&lt;h2&gt;Thanks&lt;/h2&gt;

Thanks @Model.Name @Model.Surname for contacting us. We will contact you as soon as possible.

&lt;br/&gt;

@Html.ActionLink("Return to index", "Index", "Home", null, new {id="returnToHomeLink"})</pre>
<p>Finally, let's add the new option to main menu</p>
<pre class="brush:php">&lt;li&gt;@Html.ActionLink("Information", "Index", "InformationRequest", null, new {id="informationRequestMenuLink"})&lt;/li&gt;</pre>
<p>Ok, now we can start writing our tests. Lets start with a simple assert. Go to the javascript file where your are writing the tests and put the following code</p>
<pre class="brush:javascript">var url = 'http://localhost:8000/';
casper.start(url, function() {
    this.test.assert(this.getCurrentUrl() === url, 'url is the one expected');
});

casper.run(function () {
    this.test.done();
    this.echo("Done.").exit();
});</pre>
<p>If you execute the file as usual</p>
<pre class="brush:bash">casperjs testCasperjs.js</pre>
<p>The output should be</p>
<p>[caption id="attachment_80" align="alignnone" width="677"]<a href="http://vgaltes.com/wp-content/uploads/2013/03/test1.png"><img class="size-full wp-image-80" alt="test1" src="http://vgaltes.com/wp-content/uploads/2013/03/test1.png" width="677" height="88" /></a> test 1[/caption]</p>
<p>Great! We have our first test passing.</p>
<p>Now, we will do the same same assertion than in the previous article, but using the test API.</p>
<pre class="brush:javascript">casper.then(function() {
    this.test.assertResourceExists('error.js', 'error.js script was loaded');
});</pre>
<p>And the output should be</p>
<p>[caption id="attachment_82" align="alignnone" width="677"]<a href="http://vgaltes.com/wp-content/uploads/2013/03/test2.png"><img class="size-full wp-image-82" alt="test 2" src="http://vgaltes.com/wp-content/uploads/2013/03/test2.png" width="677" height="102" /></a> test 2[/caption]</p>
<p>Let's continue with our first interaction. We will click a link in the main menu and assert that we have navigated to the correct page.</p>
<pre class="brush:javascript">casper.then(function() {
    this.click('#informationRequestMenuLink');
});

casper.then(function() {
    this.test.assertTitle('Information request', 'the page has the correct title');
});</pre>
<p>The output should be:</p>
<p>[caption id="attachment_83" align="alignnone" width="677"]<a href="http://vgaltes.com/wp-content/uploads/2013/03/test3.png"><img class="size-full wp-image-83" alt="test 3" src="http://vgaltes.com/wp-content/uploads/2013/03/test3.png" width="677" height="116" /></a> test 3[/caption]</p>
<p>Now we will fill a form, submit it and check that we are in the correct page.</p>
<pre class="brush:javascript">casper.then(function() {
    this.fill('form', {
        'Name': 'John',
        'Surname': 'Smith',
        'Email': 'jsmith@example.com',
        'Request': 'Example request'
    }, true);
});

casper.then(function() {
    this.test.assertTextExists('Thanks John Smith', 'page body contains "John Smith"');
});</pre>
<p>With the last parameter of the <em>fill</em> function we are telling CasperJs that we want to submit the form.</p>
<p>The ouput should be</p>
<p>[caption id="attachment_84" align="alignnone" width="677"]<a href="http://vgaltes.com/wp-content/uploads/2013/03/test4.png"><img class="size-full wp-image-84" alt="test 4" src="http://vgaltes.com/wp-content/uploads/2013/03/test4.png" width="677" height="121" /></a> test 4[/caption]</p>
<p>That's great!</p>
<p>Finally we will return to the main page and assert than a particular selector exists to ensure that we are in the main page.</p>
<pre class="brush:javascript">casper.then(function () {
    this.click('#returnToHomeLink');
});

casper.then(function() {
    this.test.assertSelectorExists('ol[class=round]', 'there is an ol with round class');
});</pre>
<p>And the output should be.</p>
<p>[caption id="attachment_85" align="alignnone" width="677"]<a href="http://vgaltes.com/wp-content/uploads/2013/03/test5.png"><img class="size-full wp-image-85" alt="test 5" src="http://vgaltes.com/wp-content/uploads/2013/03/test5.png" width="677" height="136" /></a> test 5[/caption]</p>
<p>We have seen how to use the test API from <a title="CasperJS" href="http://casperjs.org" target="_blank">CasperJS</a> and how to make a basic but useful interaction. I recommend you to take a look at the great <a title="CasperJS documentation" href="http://casperjs.org/api.html#intro" target="_blank">documentation </a>that <a title="CasperJS" href="http://casperjs.org" target="_blank">CasperJS </a>has. It's really good and has lots of information.</p>
<p>In the next tutorial we will see how to integrate this tests results into a <a title="Team Foundation Server" href="http://msdn.microsoft.com/en-us/vstudio/ff637362.aspx" target="_blank">Team Foundation Server</a> build.</p>
<p>See you soon!</p>
